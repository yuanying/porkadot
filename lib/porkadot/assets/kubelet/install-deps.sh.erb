#!/bin/bash

CNI_VERSION="<%= global_config.k8s.networking.cni_version %>"
mkdir -p /opt/cni/bin
curl -L "https://github.com/containernetworking/plugins/releases/download/${CNI_VERSION}/cni-plugins-linux-amd64-${CNI_VERSION}.tgz" | tar -C /opt/cni/bin -xz

RELEASE="<%= global_config.k8s.kubernetes_version %>"

mkdir -p /opt/bin
curl -L https://storage.googleapis.com/kubernetes-release/release/${RELEASE}/bin/linux/amd64/kubelet \
  -o /opt/bin/kubelet-${RELEASE}
chmod +x /opt/bin/kubelet-${RELEASE}
ln -s /opt/bin/kubelet-${RELEASE} /opt/bin/kubelet
